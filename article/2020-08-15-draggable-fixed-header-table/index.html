<!DOCTYPE html><html lang="zh-cn" data-color-mode="light"><head><meta charSet="utf-8"/><link rel="shortcut icon" href="/medias/favicon.png"/><meta content="width=device-width, initial-scale=1, viewport-fit=cover" name="viewport"/><meta content="on" http-equiv="x-dns-prefetch-control"/><meta content="telephone=no" name="format-detection"/><title>使用粘性定位(position:sticky)实现固定表头、固定列的表格组件(Vue、React) | liyang&#x27;s  blog</title><meta name="keywords" content="CSS vue react 表格"/><meta name="description" content="最近重构的项目中有这样一个页面，一个固定表头和列的表格，表格列数较多，大概有60多列，200多条数据，而且表格需要实现拖拽滚动功能。原页面的表格是用的一个比较老旧的表格插件实现，拖拽滚动是用iScroll.js实现的，性能很差，即使每页只有二、三十条数据，拖拽起来也严重卡顿。我首先使用了element-ui自带的的table组件实现了拖拽滚动的功能，性能稍微比老页面强了一点，每页50条数据时卡顿不……"/><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/59727fef85d99607.css" as="style"/><link rel="stylesheet" href="/_next/static/css/59727fef85d99607.css" data-n-g=""/><noscript data-n-css=""></noscript></head><body><div id="__next" data-reactroot=""><div class="blog-header min-w-full"><div class="container max-w-screen-lg px-2 clear-both"><div class="block text-center sm:inline-block sm:text-left "><div class=" inline-block align-top rounded-full my-2 mr-2 w-8 h-8 overflow-hidden bg-blue-400"><img class="site-logo" src="/medias/avatar.jpg" alt=""/></div><span class=" inline-block align-top mt-2.5 text-xl">liyang&#x27;s  blog</span></div><div class="block text-center sm:inline-block sm:text-left sm:float-right"><a class="inline-block nav-link py-3 px-2" href="/">首页</a><a class="inline-block nav-link py-3 px-2" href="/archives/">归档</a><a class="inline-block nav-link py-3 px-2" href="/gallery/">相册</a><a class="inline-block nav-link py-3 px-2" href="/about/">关于</a><span class="inline-block nav-link py-3 px-2" id="btn_toggle_theme" title="切换暗色模式"><i class="theme-icon"></i></span></div></div></div><div class="blog-body pt-10 pb-10"><div class="container max-w-screen-lg px-3"><main class="flex"><article class="article-content mb-5 rounded p-5 w-full "><h1 class="text-xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-6 text-center md:text-left">使用粘性定位(position:sticky)实现固定表头、固定列的表格组件(Vue、React)</h1><p class="mb-5 text-sm"><span class="mr-3">发布日期：<!-- -->2020-08-15</span><span>文章字数：<!-- -->2.8<!-- -->K</span></p><div class="mx-auto"><div class="markdown-body"><p>最近重构的项目中有这样一个页面，一个固定表头和列的表格，表格列数较多，大概有60多列，200多条数据，而且表格需要实现拖拽滚动功能。<br>原页面的表格是用的一个比较老旧的表格插件实现，拖拽滚动是用iScroll.js实现的，性能很差，即使每页只有二、三十条数据，拖拽起来也严重卡顿。我首先使用了element-ui自带的的table组件实现了拖拽滚动的功能，性能稍微比老页面强了一点，每页50条数据时卡顿不明显，超过100条数据时有才有卡顿感。然而我对这样的性能也不是很满意，就研究了下el-table固定表头和列的实现方式，发现el-table实现固定列的方式比较坑，它是渲染了两个完整的table，然后把固定列的表格宽度写死绝对定位到左侧部分，把另一个表格盖住来实现的。当数据量较多的时候会非常卡顿。<br>后来我又研究了下ant-design里面的table组件固定列的实现方式，发现ant-design的实现方式跟element-ui不一样，它不是渲染两个table，而是基于一个CSS3属性来实现的，那就是 <code>position: sticky</code>。<br>sticky直译是粘性定位，MDN上是这样介绍的：</p>
<p>元素根据正常文档流进行定位，然后相对它的最近滚动祖先（nearest scrolling ancestor）和 containing block (最近块级祖先 nearest block-level ancestor)，包括table-related元素，基于top, right, bottom, 和 left的值进行偏移。偏移值不会影响任何其他元素的位置。</p>
<p>更多介绍请看：<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position">https://developer.mozilla.org/zh-CN/docs/Web/CSS/position</a></p>
<p>然后我就尝试着使用原生html的table的结构和这个css属性实现了固定表头和列的表格组件，并添加了拖拽滚动的效果，首先看下效果：</p>
<p><img src="https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table2.gif"></p>
<p>性能方面，经测试，每页1000条数据+100列的情况下，也比原来页面的50条流畅的多：</p>
<p><img src="https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/drag-table3.gif"></p>
<p>遇到的坑：<br>滚动时固定行和列的左右边框会消失，我采用伪元素模拟右边框和下边框，并且给最外层容器添加左边框和上边框，<br>而且滚动时还有个莫名奇妙的问题，左边的文字竟然在那边框区域1px像素的区域显示出来一点，如图：</p>
<p><img src="https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_225413.png"></p>
<p>采用模拟边框后这个问题也一并解决了。<br>z-index问题，z-index要从左上角至两边递减，左上角的th要把z-index设的最大，否则滚动时右边的的th和下面的td会把第一个th盖住。</p>
<p><img src="https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200810_224153.png"></p>
<p>td和th宽度问题：当列数较多的时候，我发现即使使用行内样式写死th和td的宽度，它们的宽度也不会生效，这个问题非常蛋疼，我后来使用了一个固定宽度的span元素写在td里面才解决这个问题。</p>
<p><img src="https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_103321.png"></p>
<p>性能优化：mousemove事件是高频事件，频繁触发也会造成性能问题，这里我使用lodash的throttle方法进行节流，每60毫秒触发一次，实际使用时请先安装<code>loadsh</code>, npm i lodash </p>
<p>兼容性，只支持较新浏览器，不支持IE:</p>
<p><img src="https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/20200815_113828.png"></p>
<p>附上vue组件源码,FixedTable.vue，里面有原生html结构和el-table(注释部分)两种写法，使用el-table的话，页面数据超过50条已经有明显的卡顿</p>
<pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;list-page-container&quot;&gt;
    &lt;div class=&quot;query-box&quot;&gt;
      &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot;&gt;按钮&lt;/el-button&gt;
      &lt;el-button size=&quot;mini&quot; type=&quot;primary&quot;&gt;按钮&lt;/el-button&gt;
    &lt;/div&gt;
    &lt;div
      ref=&quot;table_wrapper&quot;
      class=&quot;table-wrapper&quot;
      style=&quot;border-top: 1px solid #cccccc; border-left: 1px solid #cccccc;&quot;
    &gt;
      &lt;table ref=&quot;tbody&quot; class=&quot;fixed-table&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th class=&quot;fixed-column&quot; style=&quot;z-index: 300&quot;&gt;
              &lt;span style=&quot;display: inline-block; width: 50px;&quot;&gt;序号&lt;/span&gt;
            &lt;/th&gt;
            &lt;th
              v-for=&quot;(columnItem,index) in lebelData&quot;
              :key=&quot;index&quot;
              :class=&quot;fixedPropList.includes(columnItem.prop)?&#39;fixed-column&#39;:&#39;&#39;&quot;
              :style=&quot;fixedPropList.includes(columnItem.prop)?&#123;
                left:index * 100 + 50 + &#39;px&#39;,
                width: &#39;100px&#39;,
                zIndex: 2 + (200-index)
              &#125;:&#123;&#125;&quot;
            &gt;
              &lt;span style=&quot;display: inline-block;width: 100px&quot;&gt;
                &#123;&#123; columnItem.label &#125;&#125;
              &lt;/span&gt;

            &lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          &lt;tr v-for=&quot;(rowItem,index) in tableData&quot; :key=&quot;index&quot;&gt;
            &lt;td class=&quot;fixed-column&quot; style=&quot;width: 50px;z-index: 200&quot;&gt;
              &#123;&#123; index+1 &#125;&#125;
            &lt;/td&gt;
            &lt;td
              v-for=&quot;(columnItem,cindex) in lebelData&quot;
              :key=&quot;cindex&quot;
              :class=&quot;fixedPropList.includes(columnItem.prop)?&#39;fixed-column&#39;:&#39;&#39;&quot;
              :style=&quot;fixedPropList.includes(columnItem.prop)?&#123;
                left: cindex * 100 + 50 + &#39;px&#39;,
                width: &#39;100px&#39;,
                zIndex: 1 + (100-cindex)
              &#125;:&#123;&#125;&quot;
            &gt;
              &lt;span style=&quot;display: inline-block;width: 100px&quot;&gt;
                &#123;&#123; rowItem[columnItem.prop] &#125;&#125;
              &lt;/span&gt;
            &lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
      &lt;!--&lt;el-table
        ref=&quot;drag_table&quot;
        class=&quot;drag-table&quot;
        :data=&quot;tableData&quot;
        size=&quot;mini&quot;
        border
        :height=&quot;tableHeight&quot;
      &gt;
        &lt;el-table-column
          type=&quot;index&quot;
          fixed
          align=&quot;center&quot;
          label=&quot;序号&quot;
          width=&quot;50&quot;
        /&gt;
        &lt;el-table-column
          v-for=&quot;(columnItem,index) in lebelData&quot;
          :key=&quot;index&quot;
          align=&quot;center&quot;
          :fixed=&quot;fixedPropList.includes(columnItem.prop)&quot;
          :prop=&quot;columnItem.prop&quot;
          :label=&quot;columnItem.label&quot;
          width=&quot;90&quot;
        /&gt;
      &lt;/el-table&gt;--&gt;

    &lt;/div&gt;
    &lt;div class=&quot;list-page-footer&quot;&gt;
      共&#123;&#123; tableData.length &#125;&#125;条数据
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;

import &#123; throttle &#125; from &#39;lodash&#39;

/* 生成表格数据*/
function generateTableData(listLength, columnLength) &#123;
  const arr = [];
  for (let i = 1; i &lt;= listLength; i++) &#123;
    const obj = &#123;&#125;
    for (let j = 1; j &lt;= columnLength; j++) &#123;
      obj[&#39;label&#39; + j] = i + &#39;*&#39; + j + &#39;=&#39; + i * j;
    &#125;
    arr.push(obj)
  &#125;
  return arr
&#125;
/* 生成表格列数据*/
function generateLabelData(labelLength) &#123;
  const arr = []
  for (let i = 1; i &lt;= labelLength; i++) &#123;
    const obj = &#123;
      label: &#39;列&#39; + i,
      prop: &#39;label&#39; + i
    &#125;
    arr.push(obj)
  &#125;
  return arr
&#125;
export default &#123;
  name: &#39;FixedTable&#39;,
  data() &#123;
    return &#123;

      tableData: generateTableData(50, 30),
      lebelData: generateLabelData(30),
      tableHeight: 700,
      fixedPropList: [
        &#39;label1&#39;,
        &#39;label2&#39;
      ], // 固定列数据
      clickPointX: 0, // 鼠标按下时的坐标
      clickPointY: 0, // 鼠标按下时的坐标
      scrollLeft: 0, // 鼠标按下时容器的滚动距离
      scrollTop: 0, // 鼠标按下时容器的滚动距离
      table_wrapper: null // 滚动容器(表格父元素)
    &#125;
  &#125;,
  mounted() &#123;
    this.setDraggable()
  &#125;,
  methods: &#123;

    setDraggable() &#123;
      // el-table组件写法
      // const table = this.$refs.drag_table
      // const table_wrapper = table.$el.querySelector(&#39;.el-table__body-wrapper&#39;)
      // const tbody = table.$el.querySelector(&#39;.el-table__body-wrapper tbody&#39;)
      //
      // 原生table写法
      const tbody = this.$refs.tbody
      const table_wrapper = this.$refs.table_wrapper

      this.table_wrapper = table_wrapper

      tbody.addEventListener(&#39;mousedown&#39;, evt =&gt; &#123;
        console.log(&#39;鼠标按下&#39;)
        this.scrollLeft = table_wrapper.scrollLeft
        this.scrollTop = table_wrapper.scrollTop
        this.clickPointX = evt.x
        this.clickPointY = evt.y
        tbody.addEventListener(&#39;mousemove&#39;, moveHandler)
      &#125;)
      tbody.addEventListener(&#39;mouseup&#39;, evt =&gt; &#123;
        tbody.removeEventListener(&#39;mousemove&#39;, moveHandler)
      &#125;)
      tbody.addEventListener(&#39;mouseleave&#39;, evt =&gt; &#123;
        tbody.removeEventListener(&#39;mousemove&#39;, moveHandler)
      &#125;)
      const moveHandler = throttle(event =&gt; &#123;
        console.log(&#39;鼠标移动&#39;);
        // 我将表格滚动距离设置为鼠标移动距离的3倍，可根据实际情况设置成别的数值
        const newX = this.scrollLeft - (event.x - this.clickPointX) * 3
        const newY = this.scrollTop - (event.y - this.clickPointY) * 3
        this.table_wrapper.scroll(newX, newY)
      &#125;, 60)
    &#125;
  &#125;
&#125;
&lt;/script&gt;

</code></pre>
<p>之前看过不少文章说react在性能方面会比vue强不少，我简单学习了下react，用react也顺利实现了这个功能，react源码也一并附上，FixedTable.js:</p>
<pre><code class="jsx">import React from &quot;react&quot;;
import &#123; throttle &#125; from &#39;lodash&#39;

class FixedTable extends React.Component &#123;
  constructor(props) &#123;
    super(props);
    this.fixedColumns = [
      &#39;label1&#39;,
      &#39;label2&#39;,
    ];
    this.state = &#123;
      tableData: this.generateTableData(100, 50),
      labelData: this.generateLabelData(50)
    &#125;;
    this.table_wrapper = React.createRef();
  &#125;

  componentDidMount() &#123;
    this.setDraggable();
  &#125;

  setDraggable() &#123;
    const wrapper_node = this.table_wrapper.current;
    let scrollLeft = 0;
    let scrollTop = 0;
    let clickPointX = 0;
    let clickPointY = 0;
    wrapper_node.addEventListener(&quot;mousedown&quot;, (evt) =&gt; &#123;
      console.log(&quot;鼠标按下&quot;);
      scrollLeft = wrapper_node.scrollLeft;
      scrollTop = wrapper_node.scrollTop;
      clickPointX = evt.x;
      clickPointY = evt.y;
      wrapper_node.addEventListener(&quot;mousemove&quot;, moveHandler);
    &#125;);
    wrapper_node.addEventListener(&quot;mouseup&quot;, (evt) =&gt; &#123;
      wrapper_node.removeEventListener(&quot;mousemove&quot;, moveHandler);
    &#125;);
    wrapper_node.addEventListener(&quot;mouseleave&quot;, (evt) =&gt; &#123;
      wrapper_node.removeEventListener(&quot;mousemove&quot;, moveHandler);
    &#125;);

    wrapper_node.addEventListener(&quot;dragend&quot;, (evt) =&gt; &#123;
      wrapper_node.removeEventListener(&quot;mousemove&quot;, moveHandler);
    &#125;);

    const moveHandler = throttle(event =&gt; &#123;
      console.log(&quot;moveHandler 触发&quot;);
      // 我将表格滚动距离设置为鼠标移动距离的3倍，可根据实际情况设置成别的数值
      const newX = scrollLeft - (event.x - clickPointX) * 3;
      const newY = scrollTop - (event.y - clickPointY) * 3;
      wrapper_node.scroll(newX, newY);
    &#125;, 60)
  &#125;

  generateTableData(listLength, columnLength) &#123;
    const arr = [];
    for (let i = 1; i &lt;= listLength; i++) &#123;
      const obj = &#123;&#125;;
      for (let j = 1; j &lt;= columnLength; j++) &#123;
        obj[&quot;label&quot; + j] = i + &quot;*&quot; + j + &quot;=&quot; + i * j;
      &#125;
      arr.push(obj);
    &#125;
    return arr;
  &#125;

  /* 生成表格列数据*/
  generateLabelData(labelLength) &#123;
    const arr = [];
    for (let i = 1; i &lt;= labelLength; i++) &#123;
      const obj = &#123;
        label: &quot;列&quot; + i,
        prop: &quot;label&quot; + i
      &#125;;
      arr.push(obj);
    &#125;
    return arr;
  &#125;

  render() &#123;
    return (
      &lt;div className=&#123;&quot;table-wrapper&quot;&#125; style=&#123;&#123;
        maxHeight: '800px'
      &#125;&#125; ref=&#123;this.table_wrapper&#125;&gt;
        &lt;table className=&#123;&quot;fixed-table&quot;&#125;&gt;
          &lt;thead&gt;
          &lt;tr&gt;
            &lt;th className=&#123;&#39;fixed-column&#39;&#125; style=&#123;&#123;
              zIndex: 300
            &#125;&#125;&gt;
                &lt;span style=&#123;&#123;
                  display: 'inline-block',
                  width: '50px'
                &#125;&#125;&gt;序号&lt;/span&gt;
            &lt;/th&gt;
            &#123;this.state.labelData.map((columnItem, columnItemIndex) =&gt;
              &lt;th key=&#123;columnItemIndex&#125;
                  className=&#123;this.fixedColumns.includes(columnItem.prop) ? &#39;fixed-column&#39; : &#39;&#39;&#125;
                  style=&#123;this.fixedColumns.includes(columnItem.prop) ? &#123;
                    left: columnItemIndex * 100 + 50 + &#39;px&#39;,
                    width: &#39;100px&#39;,
                    zIndex: 2 + (100 - columnItemIndex)
                  &#125; : &#123;&#125;&#125;&gt;

                &lt;span style=&#123;&#123;
                  display: 'inline-block',
                  width: '100px'
                &#125;&#125;&gt;
                  &#123;columnItem.label&#125;
                &lt;/span&gt;
              &lt;/th&gt;
            )&#125;
          &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
          &#123;this.state.tableData.map((item, itemIndex) =&gt;
            &lt;tr key=&#123;itemIndex&#125;&gt;
              &lt;td className=&#123;&#39;fixed-column&#39;&#125; style=&#123;&#123;
                zIndex: 200
              &#125;&#125;&gt;
                &lt;span style=&#123;&#123;
                  display: 'inline-block',
                  width: '50px'
                &#125;&#125;&gt;序号&lt;/span&gt;
              &lt;/td&gt;
              &#123;this.state.labelData.map((columnItem, columnItemIndex) =&gt;
                &lt;td key=&#123;columnItemIndex&#125;
                    className=&#123;this.fixedColumns.includes(columnItem.prop) ? &#39;fixed-column&#39; : &#39;&#39;&#125;
                    style=&#123;this.fixedColumns.includes(columnItem.prop) ? &#123;
                      left: columnItemIndex * 100 + 50 + &#39;px&#39;,
                      width: &#39;100px&#39;,
                      zIndex: 1 + (100 - columnItemIndex)
                    &#125; : &#123;&#125;&#125;
                &gt;
                  &lt;span style=&#123;&#123;
                    display: 'inline-block',
                    width: '100px'
                  &#125;&#125;&gt;
                    &#123;item[columnItem.prop]&#125;
                  &lt;/span&gt;
                &lt;/td&gt;
              )&#125;
            &lt;/tr&gt;
          )&#125;
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;
    );
  &#125;
&#125;

export default FixedTable;
</code></pre>
<p>下面是样式文件,fixed-table.sass:</p>
<pre><code class="sass">.table-wrapper
    -webkit-touch-callout: none
    -webkit-user-select: none
    -khtml-user-select: none
    -moz-user-select: none
    -ms-user-select: none
    user-select: none
    max-height: 800px
    overflow: auto
    .fixed-table
        border-collapse: collapse
        table-layout: fixed
        th, td
            text-align: center
            font-size: 12px
            color: #666
            padding: 10px 0
            position: relative
            &amp;:after
                content: &#39;&#39;
                display: block
                width: 1px
                height: 100%
                background-color: #cccccc
                position: absolute
                right: 0
                top: 0
            &amp;:before
                content: &#39;&#39;
                display: block
                width: 100%
                height: 1px
                background-color: #cccccc
                position: absolute
                left: 0
                bottom: 0
            &amp;.fixed-column
                position: sticky
                background-color: #eeeeee
        th
            position: sticky
            top: 0
            z-index: 3
            background-color: #eeeeee
            font-weight: bold
        th:first-child
            position: sticky
            left: 0
            top: 0
            z-index: 4
        td:first-child
            position: sticky
            left: 0
            z-index: 3

</code></pre>
<p>顺便附上一个el-table高度自适应的mixin组件，可以实现窗口变化时也能自适应高度，如下效果：</p>
<p><img src="https://images.liyangzone.com/article_img/%E6%8A%80%E6%9C%AF%E7%9B%B8%E5%85%B3/fixed-table/resize-table1.gif"></p>
<p>ListPageResizeHandler.js</p>
<pre><code class="js">import &#123; throttle &#125; from &#39;lodash&#39;

export default &#123;
  data() &#123;
    return &#123;
      tableHeight: 700
    &#125;
  &#125;,
  mounted() &#123;
    const observeContainer = throttle(entries =&gt; &#123;
      entries.forEach(entry =&gt; &#123;
        const cr = entry.contentRect
        this.tableHeight = cr.height
      &#125;)
    &#125;, 200, &#123; leading: false &#125;)
    const observer = new ResizeObserver(observeContainer)
    observer.observe(this.$refs.table_wrapper)
    this.$once(&#39;hook:beforeDestroy&#39;, () =&gt; &#123;
      observer.disconnect()
    &#125;)
  &#125;
&#125;

</code></pre>
<p>使用方法:引入文件并在vue组件里声明 </p>
<pre><code class="html">&lt;template&gt;
&lt;div&gt;
&lt;!--....--&gt;
&lt;/div&gt;
&lt;/template&gt;

&lt;script &gt;

import ListPageResizeHandler from &#39;@/mixin/ListPageResizeHandler&#39;;

export default &#123;
//....

mixins: [ListPageResizeHandler],

//....

&#125;

&lt;/script&gt;
</code></pre>
<p style="visibility: hidden;">
<span>可拖拽表格</span>
<span>可拖拽的表格</span>
<span>拖拽的表格</span>
<span>拖拽滚动表格</span>
<span>拖拽滚动</span>
<span>表格固定表头</span>
<span>表格固定列</span>
</p>

</div><p class="date-info pt-8 font-bold leading-10 text-center hidden">本文发布于天前，文中所描述的信息可能已发生改变</p></div></article></main></div></div><footer class="blog-footer bg-neutral-50 border-neutral-200"><div class="container max-w-screen-lg px-3"><div class="md:flex justify-between block text-sm py-2"><div class="py-1 mx-3 text-center">Copyright © 2019 - 2022 <!-- -->liyang&#x27;s  blog<a href="http://beian.miit.gov.cn/"> 豫ICP备19028870号 </a></div><div class="py-1 mx-3 text-center"> Powered by<a href="https://nextjs.org/"> Next.js </a>&amp;<a href="https://hexo.io/"> Hexo </a>Created by liyang</div></div></div></footer></div></body><script id="DarkModeScript">
    let html = document.documentElement;
    let  colorScheme = localStorage.getItem('colorScheme')
    if(colorScheme&&colorScheme=='dark'){
      html.setAttribute('data-color-mode', 'dark')
    } else {
      html.setAttribute('data-color-mode', 'light')
    }
    let btn_toggle_theme = document.querySelector('#btn_toggle_theme');
    btn_toggle_theme.addEventListener('click', function () {
    let theme = html.dataset.colorMode;
      if (theme == 'light') {
        html.setAttribute('data-color-mode', 'dark')
        localStorage.setItem('colorScheme','dark');
      } else if (theme == 'dark') {
        html.setAttribute('data-color-mode', 'light')
        localStorage.setItem('colorScheme','light');
      }
    })</script><script id="DynamicLoadScript">
function PromiseForEach(arr, cb) {
    let realResult = []
    let result = Promise.resolve()
    arr.forEach((a, index) => {
      result = result.then(() => {
        return cb(a).then((res) => {
          realResult.push(res)
        })
      })
    })
    return result.then(() => {
      return realResult
    })
 }
function addScript(url) {
   return new Promise((resolve, reject) => {
     let script = document.createElement('script');
     script.src = url;
     document.documentElement.appendChild(script);
     script.onload = ()=>{
       return resolve('success')
     }
     script.onerror = ()=>{
       return reject('error')
     }
   })
 }     
function AddCss(url) {
      document.head.insertAdjacentHTML("beforeend", `<link rel="stylesheet" href="${url}">`);
}
</script><script id="ArticleTocScript">
       window.articleDate = '2020-08-15';
      let tocLinks = document.querySelectorAll('.toc-text');
      let targetLinks = document.querySelectorAll('.headerlink')
      tocLinks.forEach(function (link) {
        link.addEventListener('click', function (event) {
        let target = event.target
        event.preventDefault()
        event.stopPropagation()
        let parent = target.parentNode;
        let hash = decodeURI(parent.hash);
        let targetLink = Array.prototype.find.call(targetLinks, function (item) {
          return item.getAttribute('href') == hash
        })
        let top = targetLink.offsetTop
        window.scrollTo(0, top - 100)
        })
      })
      let dateInfoEle = document.querySelector('.date-info');
      var articleDate = new Date(window.articleDate)
    if(new Date().getTime()-articleDate.getTime()>180 * 24 * 3600 *1000){
      let date = Math.ceil((new Date().getTime()-articleDate.getTime())/24/3600/1000)
      dateInfoEle.style.display = 'block';
      dateInfoEle.innerText = `本文发布于${date}天前，文中所描述的信息可能已发生改变。`
    }
addScript('https://unpkg.com/@highlightjs/cdn-assets@11.5.0/highlight.min.js').then(res => {
   document.querySelectorAll('pre code').forEach((el) => {
    hljs.highlightElement(el);
  });
})     
      </script><script id="StatisticScript">
let runningOnBrowser = typeof window !== "undefined";
    let isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
let supportsIntersectionObserver = runningOnBrowser && "IntersectionObserver" in window;
    if(!isBot&&supportsIntersectionObserver){
      if(!navigator.userAgent.includes('Chrome/78')){
        addScript('https://hm.baidu.com/hm.js?3123469f7f81d45d6c4cd4a6a84ccf68');
        addScript('https://js.users.51.la/21306481.js');
      }
    }
  </script></html>